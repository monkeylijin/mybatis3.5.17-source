# æˆ‘çš„ MyBatis æ¶æ„å›¾ç»˜åˆ¶

## ğŸ“Š ä»»åŠ¡è¯´æ˜

è¿™æ˜¯ç¬¬1ç¯‡çš„å®è·µä»»åŠ¡ï¼šç»˜åˆ¶ MyBatis æ•´ä½“æ¶æ„å›¾

**è¦æ±‚**ï¼š
1. ä¸‰å±‚æ¶æ„çš„åˆ’åˆ†
2. æ ¸å¿ƒç»„ä»¶çš„ä½ç½®
3. ç»„ä»¶é—´çš„ä¾èµ–å…³ç³»
4. æ•°æ®æµè½¬çš„æ–¹å‘

## ğŸ¨ æˆ‘çš„æ¶æ„å›¾

### ç‰ˆæœ¬1ï¼šåŸºç¡€æ¶æ„å›¾

```mermaid
graph TD
    subgraph "ç”¨æˆ·å±‚"
        A[ç”¨æˆ·åº”ç”¨] --> B[SqlSession]
    end
    
    subgraph "æ¥å£å±‚ (Interface Layer)"
        B --> C[SqlSessionFactory]
        B --> D[Mapperæ¥å£]
    end
    
    subgraph "æ ¸å¿ƒå¤„ç†å±‚ (Core Processing Layer)"
        B --> E[Executor]
        E --> F[StatementHandler]
        F --> G[ParameterHandler]
        F --> H[ResultSetHandler]
    end
    
    subgraph "åŸºç¡€æ”¯æŒå±‚ (Foundation Layer)"
        I[Configuration] --> B
        I --> E
        I --> F
        J[åå°„æ¨¡å—] --> B
        K[ç±»å‹è½¬æ¢] --> G
        K --> H
        L[æ—¥å¿—æ¨¡å—] --> E
        M[IOæ¨¡å—] --> I
        N[è§£æå™¨æ¨¡å—] --> F
        O[æ•°æ®æºæ¨¡å—] --> E
        P[äº‹åŠ¡æ¨¡å—] --> E
        Q[ç¼“å­˜æ¨¡å—] --> E
    end
    
    subgraph "æ•°æ®åº“å±‚"
        G --> R[JDBC]
        H --> R
        R --> S[æ•°æ®åº“]
    end
```

### ç‰ˆæœ¬2ï¼šè¯¦ç»†æ¶æ„å›¾

```mermaid
graph TB
    subgraph "åº”ç”¨å±‚"
        App[ç”¨æˆ·åº”ç”¨ç¨‹åº]
    end
    
    subgraph "MyBatis æ¥å£å±‚"
        App --> SqlSession[SqlSession<br/>ä¼šè¯ç®¡ç†]
        SqlSession --> SqlSessionFactory[SqlSessionFactory<br/>ä¼šè¯å·¥å‚]
        SqlSession --> Mapper[Mapperæ¥å£<br/>æ•°æ®è®¿é—®æ¥å£]
    end
    
    subgraph "MyBatis æ ¸å¿ƒå¤„ç†å±‚"
        SqlSession --> Executor[Executor<br/>æ‰§è¡Œå™¨]
        Executor --> SimpleExecutor[SimpleExecutor<br/>ç®€å•æ‰§è¡Œå™¨]
        Executor --> ReuseExecutor[ReuseExecutor<br/>é‡ç”¨æ‰§è¡Œå™¨]
        Executor --> BatchExecutor[BatchExecutor<br/>æ‰¹å¤„ç†æ‰§è¡Œå™¨]
        Executor --> CachingExecutor[CachingExecutor<br/>ç¼“å­˜æ‰§è¡Œå™¨]
        
        Executor --> StatementHandler[StatementHandler<br/>è¯­å¥å¤„ç†å™¨]
        StatementHandler --> PreparedStatementHandler[PreparedStatementHandler<br/>é¢„ç¼–è¯‘è¯­å¥å¤„ç†å™¨]
        StatementHandler --> SimpleStatementHandler[SimpleStatementHandler<br/>ç®€å•è¯­å¥å¤„ç†å™¨]
        StatementHandler --> CallableStatementHandler[CallableStatementHandler<br/>å­˜å‚¨è¿‡ç¨‹å¤„ç†å™¨]
        
        StatementHandler --> ParameterHandler[ParameterHandler<br/>å‚æ•°å¤„ç†å™¨]
        StatementHandler --> ResultSetHandler[ResultSetHandler<br/>ç»“æœé›†å¤„ç†å™¨]
    end
    
    subgraph "MyBatis åŸºç¡€æ”¯æŒå±‚"
        Configuration[Configuration<br/>é…ç½®ä¸­å¿ƒ] --> SqlSession
        Configuration --> Executor
        Configuration --> StatementHandler
        
        TypeHandlerRegistry[TypeHandlerRegistry<br/>ç±»å‹å¤„ç†å™¨æ³¨å†Œè¡¨] --> ParameterHandler
        TypeHandlerRegistry --> ResultSetHandler
        
        MapperRegistry[MapperRegistry<br/>Mapperæ³¨å†Œè¡¨] --> Mapper
        
        InterceptorChain[InterceptorChain<br/>æ‹¦æˆªå™¨é“¾] --> Executor
        
        Cache[Cache<br/>ç¼“å­˜ç³»ç»Ÿ] --> Executor
        
        Transaction[Transaction<br/>äº‹åŠ¡ç®¡ç†] --> Executor
        
        DataSource[DataSource<br/>æ•°æ®æº] --> Executor
    end
    
    subgraph "JDBCå±‚"
        ParameterHandler --> JDBC[JDBC API]
        ResultSetHandler --> JDBC
        JDBC --> Database[æ•°æ®åº“]
    end
    
    subgraph "æ•°æ®æµè½¬"
        App -.->|1.è¯·æ±‚| SqlSession
        SqlSession -.->|2.å§”æ‰˜| Executor
        Executor -.->|3.æ‰§è¡Œ| StatementHandler
        StatementHandler -.->|4.å‚æ•°ç»‘å®š| ParameterHandler
        StatementHandler -.->|5.ç»“æœå¤„ç†| ResultSetHandler
        ParameterHandler -.->|6.JDBCè°ƒç”¨| JDBC
        ResultSetHandler -.->|7.ç»“æœè¿”å›| SqlSession
        SqlSession -.->|8.è¿”å›ç»“æœ| App
    end
```

## ğŸ“ æ¶æ„å›¾è¯´æ˜

### 1. ä¸‰å±‚æ¶æ„åˆ’åˆ†

**æ¥å£å±‚ (Interface Layer)**ï¼š
- SqlSessionï¼šæ ¸å¿ƒä¼šè¯æ¥å£
- SqlSessionFactoryï¼šä¼šè¯å·¥å‚
- Mapperæ¥å£ï¼šæ•°æ®è®¿é—®æ¥å£

**æ ¸å¿ƒå¤„ç†å±‚ (Core Processing Layer)**ï¼š
- Executorï¼šæ‰§è¡Œå™¨ä½“ç³»
- StatementHandlerï¼šè¯­å¥å¤„ç†å™¨
- ParameterHandlerï¼šå‚æ•°å¤„ç†å™¨
- ResultSetHandlerï¼šç»“æœé›†å¤„ç†å™¨

**åŸºç¡€æ”¯æŒå±‚ (Foundation Layer)**ï¼š
- Configurationï¼šé…ç½®ä¸­å¿ƒ
- å„ç§Registryï¼šæ³¨å†Œè¡¨ç®¡ç†
- å·¥å…·æ¨¡å—ï¼šåå°„ã€ç±»å‹è½¬æ¢ã€æ—¥å¿—ç­‰

### 2. æ ¸å¿ƒç»„ä»¶ä½ç½®

- **æ¥å£å±‚**ï¼šæä¾›å¯¹å¤–çš„APIæ¥å£
- **æ ¸å¿ƒå¤„ç†å±‚**ï¼šå¤„ç†SQLæ‰§è¡Œçš„æ ¸å¿ƒé€»è¾‘
- **åŸºç¡€æ”¯æŒå±‚**ï¼šæä¾›åŸºç¡€åŠŸèƒ½æ”¯æŒ

### 3. ç»„ä»¶ä¾èµ–å…³ç³»

- SqlSession ä¾èµ– Executor
- Executor ä¾èµ– StatementHandler
- StatementHandler ä¾èµ– ParameterHandler å’Œ ResultSetHandler
- æ‰€æœ‰ç»„ä»¶éƒ½ä¾èµ– Configuration

### 4. æ•°æ®æµè½¬æ–¹å‘

```
ç”¨æˆ·è¯·æ±‚ â†’ SqlSession â†’ Executor â†’ StatementHandler â†’ JDBC â†’ æ•°æ®åº“
         â†‘                                                    â†“
         â† ResultSetHandler â† StatementHandler â† Executor â† ç»“æœé›†
```

## ğŸ” è®¾è®¡æ€è€ƒ

### 1. ä¸ºä»€ä¹ˆé‡‡ç”¨ä¸‰å±‚æ¶æ„ï¼Ÿ

1. **èŒè´£åˆ†ç¦»**ï¼šæ¯å±‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£
2. **æ¾è€¦åˆ**ï¼šå±‚ä¸å±‚ä¹‹é—´é€šè¿‡æ¥å£äº¤äº’
3. **å¯æ‰©å±•**ï¼šæ¯å±‚éƒ½å¯ä»¥ç‹¬ç«‹æ‰©å±•
4. **å¯ç»´æŠ¤**ï¼šé—®é¢˜å®šä½å’Œä¿®å¤æ›´å®¹æ˜“

### 2. æ ¸å¿ƒç»„ä»¶çš„è®¾è®¡æ€æƒ³

1. **SqlSession**ï¼šä½œä¸ºä¸»è¦å…¥å£ï¼Œå°è£…å¤æ‚æ“ä½œ
2. **Executor**ï¼šä½œä¸ºæ‰§è¡Œæ ¸å¿ƒï¼Œæ”¯æŒä¸åŒç­–ç•¥
3. **StatementHandler**ï¼šå°è£…JDBCæ“ä½œï¼Œæä¾›ç»Ÿä¸€æ¥å£
4. **Configuration**ï¼šä½œä¸ºé…ç½®ä¸­å¿ƒï¼Œç»Ÿä¸€ç®¡ç†é…ç½®

### 3. æ•°æ®æµè½¬çš„è®¾è®¡

1. **å•å‘æµåŠ¨**ï¼šè¯·æ±‚å’Œå“åº”éƒ½æœ‰æ˜ç¡®çš„æµå‘
2. **åˆ†å±‚å¤„ç†**ï¼šæ¯å±‚å¤„ç†ç‰¹å®šçš„é€»è¾‘
3. **æ¥å£éš”ç¦»**ï¼šé€šè¿‡æ¥å£å®ç°å±‚é—´è§£è€¦

## ğŸ“Š æ¶æ„å›¾è¯„ä»·

### ä¼˜ç‚¹

1. **ç»“æ„æ¸…æ™°**ï¼šä¸‰å±‚æ¶æ„åˆ’åˆ†æ˜ç¡®
2. **ç»„ä»¶å®Œæ•´**ï¼šåŒ…å«äº†æ‰€æœ‰æ ¸å¿ƒç»„ä»¶
3. **å…³ç³»æ˜ç¡®**ï¼šç»„ä»¶é—´ä¾èµ–å…³ç³»æ¸…æ™°
4. **æµç¨‹æ¸…æ¥š**ï¼šæ•°æ®æµè½¬æ–¹å‘æ˜ç¡®

### æ”¹è¿›ç©ºé—´

1. **å¯ä»¥æ·»åŠ æ›´å¤šç»†èŠ‚**ï¼šå¦‚å…·ä½“çš„å®ç°ç±»
2. **å¯ä»¥æ ‡æ³¨æ›´å¤šä¿¡æ¯**ï¼šå¦‚ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ
3. **å¯ä»¥ä¼˜åŒ–å¸ƒå±€**ï¼šä½¿å›¾è¡¨æ›´åŠ ç¾è§‚

## ğŸ¯ å­¦ä¹ æ”¶è·

é€šè¿‡ç»˜åˆ¶è¿™ä¸ªæ¶æ„å›¾ï¼Œæˆ‘ï¼š

1. **æ·±å…¥ç†è§£äº†MyBatisçš„æ•´ä½“æ¶æ„**
2. **æŒæ¡äº†ä¸‰å±‚æ¶æ„çš„è®¾è®¡æ€æƒ³**
3. **ç†è§£äº†ç»„ä»¶é—´çš„åä½œå…³ç³»**
4. **åŸ¹å…»äº†æ¶æ„æ€ç»´å’Œç»˜å›¾èƒ½åŠ›**

## ğŸ“ åç»­è®¡åˆ’

1. **ç»§ç»­æ·±å…¥å­¦ä¹ **ï¼šåŸºäºæ¶æ„å›¾æ·±å…¥å­¦ä¹ æºç 
2. **å®Œå–„æ¶æ„å›¾**ï¼šæ ¹æ®å­¦ä¹ è¿›åº¦ä¸æ–­å®Œå–„
3. **å®è·µåº”ç”¨**ï¼šå°†æ¶æ„ç†è§£åº”ç”¨åˆ°å®é™…é¡¹ç›®ä¸­

---

**ç»˜åˆ¶æ—¶é—´**ï¼š[å¡«å†™æ—¶é—´]  
**ç»˜åˆ¶å·¥å…·**ï¼š[å¡«å†™å·¥å…·]  
**å­¦ä¹ çŠ¶æ€**ï¼šå·²å®Œæˆ âœ…

