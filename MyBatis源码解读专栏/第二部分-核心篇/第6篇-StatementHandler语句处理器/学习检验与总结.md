# ç¬¬6ç¯‡ï¼šStatementHandlerè¯­å¥å¤„ç†å™¨ - å­¦ä¹ æ£€éªŒä¸æ€»ç»“

## ğŸ“Š å­¦ä¹ è¿›åº¦æ£€æŸ¥

- [ ] å·²å®Œæˆæ–‡ç« å†…å®¹é˜…è¯»
- [ ] å·²å®Œæˆæ¶æ„æ€»è§ˆåˆ†æé˜…è¯»
- [ ] å·²å®Œæˆæ€è€ƒé¢˜è§£ç­”å­¦ä¹ 
- [ ] å·²å®Œæˆå®è·µä»»åŠ¡æŒ‡å¯¼é˜…è¯»
- [ ] å·²å®Œæˆä»£ç ç¤ºä¾‹ç¼–å†™å’Œè¿è¡Œ
- [ ] å·²å®Œæˆå­¦ä¹ æ€»ç»“

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡è¾¾æˆæ£€éªŒ

### 1. åŸºç¡€ç†è§£é¢˜ï¼ˆå¿…ç­”ï¼‰

#### 1.1 StatementHandlerä½“ç³»ç»“æ„
**é—®é¢˜**ï¼šè¯·è¯´æ˜MyBatisä¸­StatementHandlerçš„ç»§æ‰¿å…³ç³»ï¼Œå„ä¸ªå®ç°ç±»çš„èŒè´£æ˜¯ä»€ä¹ˆï¼Ÿ

**å‚è€ƒç­”æ¡ˆè¦ç‚¹**ï¼š
- **StatementHandleræ¥å£**ï¼šå®šä¹‰SQLè¯­å¥å¤„ç†è§„èŒƒ
- **BaseStatementHandler**ï¼šæŠ½è±¡åŸºç±»ï¼Œå®ç°é€šç”¨é€»è¾‘
- **PreparedStatementHandler**ï¼šå¤„ç†é¢„ç¼–è¯‘è¯­å¥ï¼Œæ”¯æŒå‚æ•°ç»‘å®š
- **CallableStatementHandler**ï¼šå¤„ç†å­˜å‚¨è¿‡ç¨‹è°ƒç”¨
- **SimpleStatementHandler**ï¼šå¤„ç†é™æ€SQL
- **RoutingStatementHandler**ï¼šè·¯ç”±å™¨ï¼Œæ ¹æ®StatementTypeé€‰æ‹©å…·ä½“å®ç°

#### 1.2 è·¯ç”±æœºåˆ¶ç†è§£
**é—®é¢˜**ï¼šRoutingStatementHandleræ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªç±»ï¼Ÿ

**å‚è€ƒç­”æ¡ˆè¦ç‚¹**ï¼š
- æ ¹æ®MappedStatementçš„statementTypeå±æ€§è¿›è¡Œè·¯ç”±
- åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»ºå¯¹åº”çš„delegateï¼ˆSIMPLE/PREPARED/CALLABLEï¼‰
- æ‰€æœ‰æ–¹æ³•è°ƒç”¨éƒ½å§”æ‰˜ç»™delegateæ‰§è¡Œ
- ä¼˜åŠ¿ï¼šç»Ÿä¸€å…¥å£ã€ç®€åŒ–è°ƒç”¨ã€ä¾¿äºæ‰©å±•

#### 1.3 æ‰§è¡Œæµç¨‹ç†è§£
**é—®é¢˜**ï¼šæè¿°ä¸€ä¸ªSQLè¯­å¥é€šè¿‡StatementHandleræ‰§è¡Œçš„å®Œæ•´æµç¨‹ã€‚

**å‚è€ƒç­”æ¡ˆè¦ç‚¹**ï¼š
1. Executorè°ƒç”¨Configuration.newStatementHandler()åˆ›å»ºRoutingStatementHandler
2. RoutingStatementHandleræ ¹æ®ç±»å‹åˆ›å»ºå…·ä½“çš„Handler
3. è°ƒç”¨prepare()æ–¹æ³•åˆ›å»ºStatementå¯¹è±¡
4. è°ƒç”¨parameterize()è®¾ç½®å‚æ•°ï¼ˆå§”æ‰˜ç»™ParameterHandlerï¼‰
5. è°ƒç”¨query()æˆ–update()æ‰§è¡ŒSQL
6. è°ƒç”¨ResultSetHandlerå¤„ç†ç»“æœé›†ï¼ˆæŸ¥è¯¢æ“ä½œï¼‰
7. è¿”å›ç»“æœç»™Executor

### 2. æºç åˆ†æé¢˜ï¼ˆå¿…ç­”ï¼‰

#### 2.1 PreparedStatementHandleræºç 
**é—®é¢˜**ï¼šPreparedStatementHandlerçš„prepare()æ–¹æ³•åšäº†å“ªäº›å·¥ä½œï¼Ÿ

**å‚è€ƒç­”æ¡ˆè¦ç‚¹**ï¼š
```java
1. è°ƒç”¨instantiateStatement()åˆ›å»ºPreparedStatement
2. è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆtransaction timeoutï¼‰
3. è®¾ç½®fetchSizeï¼ˆç»“æœé›†è·å–å¤§å°ï¼‰
4. è¿”å›åˆ›å»ºçš„PreparedStatementå¯¹è±¡
```

#### 2.2 å‚æ•°å¤„ç†æµç¨‹
**é—®é¢˜**ï¼šparameterize()æ–¹æ³•æ˜¯å¦‚ä½•è®¾ç½®å‚æ•°çš„ï¼Ÿ

**å‚è€ƒç­”æ¡ˆè¦ç‚¹**ï¼š
```java
1. è·å–ParameterHandler
2. è°ƒç”¨parameterHandler.setParameters(ps)
3. ParameterHandleréå†æ‰€æœ‰å‚æ•°æ˜ å°„
4. é€šè¿‡TypeHandlerå°†Javaç±»å‹è½¬æ¢ä¸ºJDBCç±»å‹
5. è°ƒç”¨PreparedStatement.setXxx()è®¾ç½®å‚æ•°
```

### 3. å®è·µåº”ç”¨é¢˜ï¼ˆå¿…ç­”ï¼‰

#### 3.1 æ€§èƒ½ä¼˜åŒ–åœºæ™¯
**é—®é¢˜**ï¼šåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹åº”è¯¥ä½¿ç”¨ReuseExecutorï¼Ÿè¯·ç»™å‡ºå…·ä½“ç¤ºä¾‹ã€‚

**å‚è€ƒç­”æ¡ˆè¦ç‚¹**ï¼š
- é€‚ç”¨åœºæ™¯ï¼šåŒä¸€ä¸ªSqlSessionä¸­é¢‘ç¹æ‰§è¡Œç›¸åŒSQL
- ä¼˜åŠ¿ï¼šå¤ç”¨PreparedStatementå¯¹è±¡ï¼Œå‡å°‘åˆ›å»ºå¼€é”€
- ç¤ºä¾‹ï¼šå¾ªç¯æŸ¥è¯¢ã€æ‰¹é‡éªŒè¯ç­‰
- æ³¨æ„ï¼šä¸åŒå‚æ•°çš„ç›¸åŒSQLæ‰ä¼šå¤ç”¨

#### 3.2 æ‰¹é‡æ“ä½œå®è·µ
**é—®é¢˜**ï¼šä½¿ç”¨BatchExecutorè¿›è¡Œæ‰¹é‡æ’å…¥æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ

**å‚è€ƒç­”æ¡ˆè¦ç‚¹**ï¼š
- å¿…é¡»æ˜¾å¼è°ƒç”¨flushStatements()
- æ‰¹é‡æ“ä½œä¸ä¼šç«‹å³è¿”å›å½±å“è¡Œæ•°
- éœ€è¦åˆç†æ§åˆ¶æ‰¹æ¬¡å¤§å°ï¼Œé¿å…å†…å­˜æº¢å‡º
- äº‹åŠ¡ç®¡ç†è¦æ­£ç¡®ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- SelectKeyä¸é€‚ç”¨äºæ‰¹é‡æ“ä½œ

### 4. æ‰©å±•æ€è€ƒé¢˜ï¼ˆé€‰ç­”ï¼‰

#### 4.1 è‡ªå®šä¹‰æ‰©å±•
**é—®é¢˜**ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„StatementHandleræ¥è®°å½•SQLæ‰§è¡Œæ—¥å¿—ï¼Ÿ

**å‚è€ƒæ€è·¯**ï¼š
```java
1. å®ç°StatementHandleræ¥å£
2. ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼åŒ…è£…ç°æœ‰Handler
3. åœ¨prepare()ã€query()ã€update()æ–¹æ³•ä¸­è®°å½•æ—¥å¿—
4. é€šè¿‡Pluginæ‹¦æˆªå™¨æ³¨å…¥è‡ªå®šä¹‰Handler
```

#### 4.2 æ€§èƒ½ç›‘æ§
**é—®é¢˜**ï¼šè®¾è®¡ä¸€ä¸ªæ…¢SQLæ£€æµ‹æœºåˆ¶ï¼Œå½“SQLæ‰§è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼æ—¶å‘å‡ºå‘Šè­¦ã€‚

**å‚è€ƒæ€è·¯**ï¼š
```java
1. åœ¨prepare()è®°å½•å¼€å§‹æ—¶é—´
2. åœ¨query/updateæ‰§è¡Œåè®¡ç®—è€—æ—¶
3. è¶…è¿‡é˜ˆå€¼æ—¶è®°å½•åˆ°æ—¥å¿—æˆ–å‘é€å‘Šè­¦
4. ç»Ÿè®¡æ…¢SQLå‡ºç°é¢‘ç‡å’Œå¹³å‡è€—æ—¶
```

---

## ğŸ“ çŸ¥è¯†ç‚¹æ€»ç»“

### æ ¸å¿ƒæ¦‚å¿µæ¸…å•

- [ ] StatementHandleræ¥å£åŠå…¶å®ç°ç±»
- [ ] RoutingStatementHandlerè·¯ç”±æœºåˆ¶
- [ ] PreparedStatementçš„é¢„ç¼–è¯‘åŸç†
- [ ] CallableStatementå­˜å‚¨è¿‡ç¨‹è°ƒç”¨
- [ ] Statementä¸ParameterHandlerçš„åä½œ
- [ ] Statementä¸ResultSetHandlerçš„åä½œ
- [ ] ä¸åŒExecutorå¯¹Statementçš„ä½¿ç”¨ç­–ç•¥

### é‡è¦æºç ä½ç½®

```
org.apache.ibatis.executor.statement.StatementHandler
org.apache.ibatis.executor.statement.BaseStatementHandler
org.apache.ibatis.executor.statement.PreparedStatementHandler
org.apache.ibatis.executor.statement.CallableStatementHandler
org.apache.ibatis.executor.statement.SimpleStatementHandler
org.apache.ibatis.executor.statement.RoutingStatementHandler
```

### å…³é”®è®¾è®¡æ¨¡å¼

- **ç­–ç•¥æ¨¡å¼**ï¼šä¸åŒStatementHandlerå¤„ç†ä¸åŒç±»å‹çš„Statement
- **æ¨¡æ¿æ–¹æ³•æ¨¡å¼**ï¼šBaseStatementHandlerå®šä¹‰æ‰§è¡Œæ¨¡æ¿
- **è£…é¥°å™¨æ¨¡å¼**ï¼šè‡ªå®šä¹‰HandleråŒ…è£…æ ‡å‡†Handler
- **å·¥å‚æ¨¡å¼**ï¼šConfigurationåˆ›å»ºStatementHandler

---

## ğŸ“ å­¦ä¹ æˆæœè¯„ä¼°

### è‡ªæˆ‘è¯„åˆ†ï¼ˆ1-5åˆ†ï¼‰

| è¯„ä¼°ç»´åº¦ | å¾—åˆ† | è¯´æ˜ |
|---------|------|------|
| åŸºç¡€æ¦‚å¿µç†è§£ | __/5 | å¯¹StatementHandlerä½“ç³»çš„ç†è§£ç¨‹åº¦ |
| æºç é˜…è¯»èƒ½åŠ› | __/5 | èƒ½å¦ç‹¬ç«‹é˜…è¯»å¹¶ç†è§£æºç  |
| å®è·µåŠ¨æ‰‹èƒ½åŠ› | __/5 | èƒ½å¦å®Œæˆä»£ç ç¤ºä¾‹å’Œå®è·µä»»åŠ¡ |
| é—®é¢˜åˆ†æèƒ½åŠ› | __/5 | èƒ½å¦åˆ†æå’Œè§£å†³å®é™…é—®é¢˜ |
| æ‰©å±•åˆ›æ–°èƒ½åŠ› | __/5 | èƒ½å¦è®¾è®¡è‡ªå®šä¹‰æ‰©å±• |

**æ€»åˆ†**: __/25

**è¯„çº§æ ‡å‡†**ï¼š
- 20-25åˆ†ï¼šä¼˜ç§€ï¼Œæ·±å…¥ç†è§£StatementHandleræœºåˆ¶
- 15-19åˆ†ï¼šè‰¯å¥½ï¼ŒæŒæ¡æ ¸å¿ƒæ¦‚å¿µå’Œä½¿ç”¨æ–¹æ³•
- 10-14åˆ†ï¼šåŠæ ¼ï¼Œäº†è§£åŸºæœ¬åŸç†
- 10åˆ†ä»¥ä¸‹ï¼šéœ€è¦é‡æ–°å­¦ä¹ 

---

## ğŸ’¡ å­¦ä¹ å¿ƒå¾—è®°å½•

### é‡è¦æ”¶è·

**è¯·è®°å½•ä½ åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­çš„é‡è¦æ”¶è·**ï¼š

1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

### é‡åˆ°çš„é—®é¢˜

**è¯·è®°å½•å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**ï¼š

| é—®é¢˜æè¿° | è§£å†³æ–¹æ¡ˆ |
|---------|---------|
|         |         |
|         |         |

### å®è·µç»éªŒ

**è¯·è®°å½•å®è·µè¿‡ç¨‹ä¸­çš„ç»éªŒå’ŒæŠ€å·§**ï¼š

1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

---

## ğŸ”— å»¶ä¼¸å­¦ä¹ å»ºè®®

### ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘

1. **æ·±å…¥ç ”ç©¶ParameterHandler**ï¼šç†è§£å‚æ•°å¤„ç†æœºåˆ¶
2. **å­¦ä¹ ResultSetHandler**ï¼šæŒæ¡ç»“æœé›†æ˜ å°„åŸç†
3. **ç ”ç©¶Pluginæœºåˆ¶**ï¼šå­¦ä¹ å¦‚ä½•æ‹¦æˆªStatementHandler
4. **æ€§èƒ½ä¼˜åŒ–å®è·µ**ï¼šä¸åŒåœºæ™¯ä¸‹çš„æ€§èƒ½è°ƒä¼˜ç­–ç•¥

### æ¨èé˜…è¯»

- ã€ŠMyBatisæŠ€æœ¯å†…å¹•ã€‹- StatementHandlerç« èŠ‚
- MyBatiså®˜æ–¹æ–‡æ¡£ - Statementé…ç½®
- JDBCè§„èŒƒæ–‡æ¡£ - PreparedStatementéƒ¨åˆ†

### å®è·µå»ºè®®

1. å°è¯•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ReuseExecutorä¼˜åŒ–æ€§èƒ½
2. å®ç°ä¸€ä¸ªSQLæ‰§è¡Œç›‘æ§æ’ä»¶
3. åˆ†æé¡¹ç›®ä¸­çš„æ…¢SQLå¹¶ä¼˜åŒ–
4. ç ”ç©¶BatchExecutoråœ¨æ‰¹é‡å¯¼å…¥åœºæ™¯çš„åº”ç”¨

---

## âœ… å­¦ä¹ å®Œæˆç¡®è®¤

**å®Œæˆæœ¬ç¯‡å­¦ä¹ åï¼Œè¯·ç¡®è®¤ä»¥ä¸‹å†…å®¹**ï¼š

- [ ] æˆ‘å·²ç†è§£StatementHandlerçš„è®¾è®¡æ€æƒ³å’Œå®ç°åŸç†
- [ ] æˆ‘èƒ½å¤ŸåŒºåˆ†ä¸åŒStatementHandlerçš„ä½¿ç”¨åœºæ™¯
- [ ] æˆ‘å®Œæˆäº†æ‰€æœ‰ä»£ç ç¤ºä¾‹çš„ç¼–å†™å’Œè¿è¡Œ
- [ ] æˆ‘èƒ½å¤Ÿç‹¬ç«‹å®ç°è‡ªå®šä¹‰StatementHandler
- [ ] æˆ‘ç†è§£StatementHandlerä¸å…¶ä»–ç»„ä»¶çš„åä½œå…³ç³»
- [ ] æˆ‘å·²å®Œæˆæœ¬ç¯‡çš„å­¦ä¹ æ€»ç»“

**å­¦ä¹ å®Œæˆæ—¥æœŸ**ï¼š____________

**ä¸‹ä¸€ç¯‡å­¦ä¹ è®¡åˆ’**ï¼š[ç¬¬7ç¯‡-ParameterHandlerå‚æ•°å¤„ç†æœºåˆ¶](../ç¬¬7ç¯‡-ParameterHandlerå‚æ•°å¤„ç†æœºåˆ¶/README.md)

---

**å¤‡æ³¨**ï¼šè¯·è®¤çœŸå®Œæˆå­¦ä¹ æ£€éªŒï¼Œè¿™å°†å¸®åŠ©ä½ å·©å›ºçŸ¥è¯†ã€å‘ç°ä¸è¶³ã€‚å¦‚æœ‰ç–‘é—®ï¼Œå»ºè®®é‡æ–°é˜…è¯»ç›¸å…³ç« èŠ‚æˆ–æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚
