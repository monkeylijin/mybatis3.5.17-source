# ç¬¬7ç¯‡å­¦ä¹ æ£€éªŒä¸æ€»ç»“

## ğŸ“‹ çŸ¥è¯†ç‚¹æ£€éªŒæ¸…å•

### åŸºç¡€æ¦‚å¿µç†è§£ âœ…

**1. ParameterHandleræ ¸å¿ƒèŒè´£**
- [ ] èƒ½å¤Ÿè¯´å‡ºParameterHandlerçš„ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•åŠå…¶ä½œç”¨
- [ ] ç†è§£ParameterHandleråœ¨MyBatisæ‰§è¡Œæµç¨‹ä¸­çš„ä½ç½®
- [ ] æŒæ¡ParameterHandlerä¸StatementHandlerçš„åä½œå…³ç³»

**2. DefaultParameterHandlerå®ç°æœºåˆ¶**
- [ ] æŒæ¡å‚æ•°å€¼è·å–çš„å››çº§ä¼˜å…ˆç­–ç•¥
- [ ] ç†è§£æ¯ç§å‚æ•°ç±»å‹çš„å¤„ç†æ–¹å¼ï¼ˆåŸºæœ¬ç±»å‹ã€å¤æ‚å¯¹è±¡ã€é›†åˆï¼‰
- [ ] äº†è§£MetaObjectåœ¨å‚æ•°å¤„ç†ä¸­çš„ä½œç”¨

**3. ParameterMappingå‚æ•°æ˜ å°„**
- [ ] ç†è§£ParameterMappingçš„æ ¸å¿ƒå±æ€§åŠä½œç”¨
- [ ] æŒæ¡å‚æ•°æ˜ å°„çš„æ„å»ºè¿‡ç¨‹
- [ ] äº†è§£å»ºé€ è€…æ¨¡å¼åœ¨ParameterMappingä¸­çš„åº”ç”¨

### å®è·µæŠ€èƒ½æŒæ¡ ğŸ› ï¸

**4. ç±»å‹å¤„ç†å™¨åä½œ**
- [ ] ç†è§£ParameterHandlerä¸TypeHandlerçš„åä½œæœºåˆ¶
- [ ] æŒæ¡TypeHandlerçš„é€‰æ‹©å’Œè§£æè¿‡ç¨‹
- [ ] èƒ½å¤Ÿåˆ†æç±»å‹è½¬æ¢å¤±è´¥çš„åŸå› 

**5. é¢å¤–å‚æ•°æœºåˆ¶**
- [ ] äº†è§£é¢å¤–å‚æ•°çš„äº§ç”Ÿåœºæ™¯ï¼ˆforeachã€bindç­‰ï¼‰
- [ ] ç†è§£é¢å¤–å‚æ•°çš„å­˜å‚¨å’Œä½¿ç”¨æœºåˆ¶
- [ ] æŒæ¡é¢å¤–å‚æ•°çš„ä¼˜å…ˆçº§åŸç†

**6. æ‰©å±•å¼€å‘èƒ½åŠ›**
- [ ] èƒ½å¤Ÿå¼€å‘è‡ªå®šä¹‰çš„ParameterHandlerå®ç°
- [ ] æŒæ¡å‚æ•°å¤„ç†å™¨çš„å¸¸è§æ‰©å±•åœºæ™¯ï¼ˆåŠ å¯†ã€éªŒè¯ã€æ—¥å¿—ï¼‰
- [ ] ç†è§£é€šç”¨å‚æ•°å¤„ç†å™¨çš„è®¾è®¡æ€è·¯

## ğŸ§ª å®è·µéªŒè¯

### ä»£ç è°ƒè¯•éªŒè¯
```java
/**
 * ParameterHandlerè°ƒè¯•éªŒè¯
 */
public class ParameterHandlerDebugTest {
    
    @Test
    public void testParameterHandlerFlow() {
        // 1. åˆ›å»ºæµ‹è¯•ç¯å¢ƒ
        Configuration configuration = new Configuration();
        MappedStatement ms = createTestMappedStatement(configuration);
        
        // 2. æµ‹è¯•ä¸åŒç±»å‹å‚æ•°
        testBasicTypeParameter(ms);
        testComplexObjectParameter(ms);
        testCollectionParameter(ms);
    }
    
    private void testBasicTypeParameter(MappedStatement ms) {
        // åŸºæœ¬ç±»å‹å‚æ•°æµ‹è¯•
        Object parameterObject = "testValue";
        BoundSql boundSql = createBoundSql(ms, parameterObject);
        
        ParameterHandler handler = new DefaultParameterHandler(ms, parameterObject, boundSql);
        
        // éªŒè¯å‚æ•°è·å–
        assertEquals(parameterObject, handler.getParameterObject());
        
        // éªŒè¯å‚æ•°è®¾ç½®ï¼ˆéœ€è¦Mock PreparedStatementï¼‰
    }
    
    private void testComplexObjectParameter(MappedStatement ms) {
        // å¤æ‚å¯¹è±¡å‚æ•°æµ‹è¯•
        User user = new User();
        user.setName("å¼ ä¸‰");
        user.setEmail("test@example.com");
        
        BoundSql boundSql = createBoundSql(ms, user);
        ParameterHandler handler = new DefaultParameterHandler(ms, user, boundSql);
        
        // éªŒè¯MetaObjectçš„ä½¿ç”¨
        MetaObject metaObject = ms.getConfiguration().newMetaObject(user);
        assertEquals("å¼ ä¸‰", metaObject.getValue("name"));
    }
    
    private void testCollectionParameter(MappedStatement ms) {
        // é›†åˆå‚æ•°æµ‹è¯•ï¼ˆé¢å¤–å‚æ•°ï¼‰
        List<Long> ids = Arrays.asList(1L, 2L, 3L);
        BoundSql boundSql = createBoundSqlWithAdditionalParams(ms, ids);
        
        // éªŒè¯é¢å¤–å‚æ•°
        assertTrue(boundSql.hasAdditionalParameter("__frch_id_0"));
        assertEquals(1L, boundSql.getAdditionalParameter("__frch_id_0"));
    }
}
```

### æ‰©å±•åŠŸèƒ½éªŒè¯
```java
/**
 * è‡ªå®šä¹‰å‚æ•°å¤„ç†å™¨éªŒè¯
 */
public class CustomParameterHandlerTest {
    
    @Test
    public void testEncryptionParameterHandler() {
        // æµ‹è¯•åŠ å¯†å‚æ•°å¤„ç†å™¨
        User user = new User();
        user.setPassword("mypassword");
        
        MappedStatement ms = createTestMappedStatement();
        BoundSql boundSql = createBoundSql(ms, user);
        
        EncryptionParameterHandler handler = new EncryptionParameterHandler(ms, user, boundSql);
        
        PreparedStatement ps = mock(PreparedStatement.class);
        
        // æ‰§è¡Œå‚æ•°è®¾ç½®
        handler.setParameters(ps);
        
        // éªŒè¯å¯†ç å·²è¢«åŠ å¯†
        verify(ps).setString(anyInt(), argThat(value -> 
            !value.equals("mypassword") && value.length() > "mypassword".length()));
    }
    
    @Test
    public void testValidationParameterHandler() {
        // æµ‹è¯•éªŒè¯å‚æ•°å¤„ç†å™¨
        User user = new User();
        user.setEmail("invalid-email"); // æ— æ•ˆé‚®ç®±
        
        ValidationParameterHandler handler = new ValidationParameterHandler(ms, user, boundSql);
        
        PreparedStatement ps = mock(PreparedStatement.class);
        
        // éªŒè¯åº”è¯¥æŠ›å‡ºå¼‚å¸¸
        assertThrows(SQLException.class, () -> {
            handler.setParameters(ps);
        });
    }
}
```

## ğŸ“Š å­¦ä¹ æˆæœè¯„ä¼°

### ç†è®ºçŸ¥è¯†è¯„åˆ†ï¼ˆ40%ï¼‰

**ä¼˜ç§€ï¼ˆ90-100åˆ†ï¼‰**ï¼š
- å®Œå…¨ç†è§£ParameterHandlerçš„è®¾è®¡æ€æƒ³å’Œå®ç°åŸç†
- èƒ½å¤Ÿæ¸…æ™°è¯´æ˜å‚æ•°å¤„ç†çš„å®Œæ•´æµç¨‹
- æŒæ¡æ‰€æœ‰å‚æ•°ç±»å‹çš„å¤„ç†å·®å¼‚å’Œåº”ç”¨åœºæ™¯

**è‰¯å¥½ï¼ˆ80-89åˆ†ï¼‰**ï¼š
- åŸºæœ¬ç†è§£ParameterHandlerçš„æ ¸å¿ƒåŠŸèƒ½
- äº†è§£ä¸»è¦çš„å‚æ•°å¤„ç†ç­–ç•¥
- èƒ½å¤Ÿåˆ†æå¸¸è§çš„å‚æ•°å¤„ç†é—®é¢˜

**åŠæ ¼ï¼ˆ60-79åˆ†ï¼‰**ï¼š
- çŸ¥é“ParameterHandlerçš„åŸºæœ¬ä½œç”¨
- äº†è§£DefaultParameterHandlerçš„ç®€å•ä½¿ç”¨
- èƒ½å¤Ÿè¯†åˆ«å‚æ•°è®¾ç½®ç›¸å…³çš„é”™è¯¯

**ä¸åŠæ ¼ï¼ˆ<60åˆ†ï¼‰**ï¼š
- å¯¹ParameterHandlerçš„æ¦‚å¿µæ¨¡ç³Š
- ä¸èƒ½ç†è§£å‚æ•°å¤„ç†çš„åŸºæœ¬æµç¨‹
- æ— æ³•è§£å†³å‚æ•°ç›¸å…³çš„é—®é¢˜

### å®è·µèƒ½åŠ›è¯„åˆ†ï¼ˆ40%ï¼‰

**ä¼˜ç§€ï¼ˆ90-100åˆ†ï¼‰**ï¼š
- èƒ½å¤Ÿç†Ÿç»ƒè°ƒè¯•ParameterHandlerç›¸å…³é—®é¢˜
- å¯ä»¥å¼€å‘å¤æ‚çš„è‡ªå®šä¹‰å‚æ•°å¤„ç†å™¨
- å…·å¤‡è®¾è®¡é€šç”¨å‚æ•°å¤„ç†æ¡†æ¶çš„èƒ½åŠ›

**è‰¯å¥½ï¼ˆ80-89åˆ†ï¼‰**ï¼š
- èƒ½å¤Ÿè¿›è¡ŒåŸºæœ¬çš„æºç è°ƒè¯•
- å¯ä»¥å®ç°ç®€å•çš„å‚æ•°å¤„ç†æ‰©å±•
- èƒ½å¤Ÿè§£å†³å¸¸è§çš„å‚æ•°å¤„ç†é—®é¢˜

**åŠæ ¼ï¼ˆ60-79åˆ†ï¼‰**ï¼š
- èƒ½å¤Ÿä½¿ç”¨åŸºæœ¬çš„è°ƒè¯•æŠ€å·§
- å¯ä»¥ç†è§£å’Œä¿®æ”¹ç°æœ‰çš„å‚æ•°å¤„ç†ä»£ç 
- èƒ½å¤Ÿé…ç½®å’Œä½¿ç”¨å‚æ•°å¤„ç†ç›¸å…³åŠŸèƒ½

**ä¸åŠæ ¼ï¼ˆ<60åˆ†ï¼‰**ï¼š
- ä¸ä¼šä½¿ç”¨è°ƒè¯•å·¥å…·
- æ— æ³•ç†è§£å‚æ•°å¤„ç†çš„æºç 
- ä¸èƒ½è§£å†³åŸºæœ¬çš„å‚æ•°é—®é¢˜

### ç»¼åˆåº”ç”¨è¯„åˆ†ï¼ˆ20%ï¼‰

**ä¼˜ç§€ï¼ˆ90-100åˆ†ï¼‰**ï¼š
- èƒ½å¤Ÿå°†ParameterHandlerçŸ¥è¯†åº”ç”¨åˆ°å®é™…é¡¹ç›®ä¸­
- å¯ä»¥ç»“åˆä¸šåŠ¡éœ€æ±‚è®¾è®¡å‚æ•°å¤„ç†æ–¹æ¡ˆ
- å…·å¤‡å‚æ•°å¤„ç†æ€§èƒ½ä¼˜åŒ–çš„èƒ½åŠ›

**è‰¯å¥½ï¼ˆ80-89åˆ†ï¼‰**ï¼š
- èƒ½å¤Ÿåœ¨é¡¹ç›®ä¸­æ­£ç¡®ä½¿ç”¨å‚æ•°å¤„ç†åŠŸèƒ½
- å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„å‚æ•°å¤„ç†ç­–ç•¥
- äº†è§£å‚æ•°å¤„ç†çš„æœ€ä½³å®è·µ

**åŠæ ¼ï¼ˆ60-79åˆ†ï¼‰**ï¼š
- èƒ½å¤Ÿåœ¨æŒ‡å¯¼ä¸‹ä½¿ç”¨å‚æ•°å¤„ç†åŠŸèƒ½
- äº†è§£åŸºæœ¬çš„å‚æ•°å¤„ç†é…ç½®æ–¹æ³•
- èƒ½å¤Ÿé¿å…å¸¸è§çš„å‚æ•°å¤„ç†é”™è¯¯

**ä¸åŠæ ¼ï¼ˆ<60åˆ†ï¼‰**ï¼š
- æ— æ³•æ­£ç¡®ä½¿ç”¨å‚æ•°å¤„ç†åŠŸèƒ½
- ä¸äº†è§£å‚æ•°å¤„ç†çš„é…ç½®æ–¹æ³•
- ç»å¸¸é‡åˆ°å‚æ•°ç›¸å…³çš„é—®é¢˜

## ğŸ¯ å­¦ä¹ å»ºè®®

### ç»§ç»­æ·±å…¥å­¦ä¹ 
1. **ç»“åˆå®é™…é¡¹ç›®**ï¼šåœ¨çœŸå®é¡¹ç›®ä¸­å®è·µå‚æ•°å¤„ç†çš„å„ç§åœºæ™¯
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šå­¦ä¹ å‚æ•°å¤„ç†çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§
3. **å®‰å…¨è€ƒè™‘**ï¼šäº†è§£å‚æ•°å¤„ç†ä¸­çš„å®‰å…¨é—®é¢˜å’Œé˜²æŠ¤æªæ–½

### æ‰©å±•å­¦ä¹ æ–¹å‘
1. **ç±»å‹ç³»ç»Ÿ**ï¼šæ·±å…¥å­¦ä¹ MyBatisçš„ç±»å‹å¤„ç†ä½“ç³»
2. **åŠ¨æ€SQL**ï¼šç»“åˆåŠ¨æ€SQLç†è§£å‚æ•°å¤„ç†çš„å¤æ‚åœºæ™¯
3. **æ’ä»¶å¼€å‘**ï¼šå­¦ä¹ é€šè¿‡æ’ä»¶æ‰©å±•å‚æ•°å¤„ç†åŠŸèƒ½

### å®è·µé¡¹ç›®å»ºè®®
1. **å‚æ•°åŠ å¯†ç»„ä»¶**ï¼šå¼€å‘é€šç”¨çš„å‚æ•°åŠ å¯†å¤„ç†ç»„ä»¶
2. **å‚æ•°éªŒè¯æ¡†æ¶**ï¼šè®¾è®¡çµæ´»çš„å‚æ•°éªŒè¯æ¡†æ¶
3. **ç›‘æ§ç»Ÿè®¡**ï¼šå®ç°å‚æ•°ä½¿ç”¨æƒ…å†µçš„ç›‘æ§å’Œç»Ÿè®¡

## ğŸ“ˆ ä¸‹ä¸€æ­¥å­¦ä¹ è®¡åˆ’

### çŸ­æœŸç›®æ ‡ï¼ˆ1-2å‘¨ï¼‰
- [ ] å®Œæˆæ‰€æœ‰ä»£ç è°ƒè¯•ç»ƒä¹ 
- [ ] å®ç°è‡³å°‘ä¸€ä¸ªè‡ªå®šä¹‰å‚æ•°å¤„ç†å™¨
- [ ] æŒæ¡å‚æ•°å¤„ç†çš„å¸¸è§é—®é¢˜è§£å†³æ–¹æ³•

### ä¸­æœŸç›®æ ‡ï¼ˆ1ä¸ªæœˆï¼‰
- [ ] åœ¨é¡¹ç›®ä¸­åº”ç”¨å‚æ•°å¤„ç†çš„æ‰©å±•åŠŸèƒ½
- [ ] æ·±å…¥å­¦ä¹ TypeHandlerç±»å‹å¤„ç†æœºåˆ¶
- [ ] äº†è§£å‚æ•°å¤„ç†çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### é•¿æœŸç›®æ ‡ï¼ˆ3ä¸ªæœˆï¼‰
- [ ] è®¾è®¡å¹¶å®ç°é€šç”¨çš„å‚æ•°å¤„ç†æ¡†æ¶
- [ ] æ·±å…¥ç†è§£MyBatisçš„ç±»å‹ç³»ç»Ÿ
- [ ] å…·å¤‡å‚æ•°å¤„ç†ç›¸å…³é—®é¢˜çš„æ¶æ„è®¾è®¡èƒ½åŠ›

## ğŸ’¡ å­¦ä¹ å¿ƒå¾—è®°å½•

### é‡è¦æ¦‚å¿µæ€»ç»“
```
1. å‚æ•°å€¼è·å–ä¼˜å…ˆçº§ï¼šé¢å¤–å‚æ•° > ç©ºå‚æ•° > åŸºæœ¬ç±»å‹ > å¤æ‚å¯¹è±¡
2. ParameterHandlerä¸TypeHandleråä½œï¼šèŒè´£åˆ†ç¦»ï¼Œå„å¸å…¶èŒ
3. é¢å¤–å‚æ•°æœºåˆ¶ï¼šæ”¯æŒåŠ¨æ€SQLçš„å…³é”®æŠ€æœ¯
4. æ‰©å±•è®¾è®¡æ¨¡å¼ï¼šè´£ä»»é“¾æ¨¡å¼ + è£…é¥°å™¨æ¨¡å¼
```

### å®è·µç»éªŒæ€»ç»“
```
1. è°ƒè¯•æŠ€å·§ï¼šè§‚å¯Ÿå‚æ•°ç±»å‹åˆ¤æ–­é€»è¾‘ï¼Œè·Ÿè¸ªå‚æ•°å€¼è·å–è¿‡ç¨‹
2. æ‰©å±•å¼€å‘ï¼šä¼˜å…ˆè€ƒè™‘ç»„åˆè€Œéç»§æ‰¿ï¼Œä¿æŒèŒè´£å•ä¸€
3. æ€§èƒ½ä¼˜åŒ–ï¼šåˆç†ä½¿ç”¨MetaObjectç¼“å­˜ï¼Œé€‰æ‹©åˆé€‚çš„TypeHandler
4. é—®é¢˜æ’æŸ¥ï¼šå‚æ•°æ˜ å°„é…ç½®æ£€æŸ¥ï¼Œç±»å‹è½¬æ¢å¼‚å¸¸åˆ†æ
```

### ç–‘éš¾é—®é¢˜è®°å½•
```
è®°å½•åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°çš„ç–‘éš¾é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š

é—®é¢˜1ï¼šå‚æ•°è®¾ç½®å¤±è´¥
è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ParameterMappingçš„javaTypeå’ŒjdbcTypeé…ç½®

é—®é¢˜2ï¼šç±»å‹è½¬æ¢å¼‚å¸¸
è§£å†³æ–¹æ¡ˆï¼šç¡®è®¤TypeHandlerçš„æ³¨å†Œå’Œé€‰æ‹©é€»è¾‘

é—®é¢˜3ï¼šåå°„è®¿é—®å¤±è´¥
è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥å±æ€§çš„getteræ–¹æ³•å’Œè®¿é—®æƒé™
```

---

**å­¦ä¹ çŠ¶æ€**ï¼š[ ] å¼€å§‹å­¦ä¹  [ ] å­¦ä¹ ä¸­ [ ] å·²å®Œæˆ

**å®Œæˆæ—¶é—´**ï¼š____å¹´____æœˆ____æ—¥

**å­¦ä¹ è¯„åˆ†**ï¼šç†è®º___åˆ†ï¼Œå®è·µ___åˆ†ï¼Œåº”ç”¨___åˆ†ï¼Œæ€»åˆ†___åˆ†